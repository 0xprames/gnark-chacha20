package org.example;

import com.sun.jna.*;

import java.util.HexFormat;


public class Main {
    static LibGnarkChacha20 INSTANCE = Native.load("/mnt/c/Coding/gnark-chacha20/prove.so", LibGnarkChacha20.class);

    public static void main(String[] args) {
        var key = HexToGoSlice("64D62633CEF699CEACB3FE625C44B5664509709D4307421C45C9B12F7132590D");
        var nonce = HexToGoSlice("0720D980CBF3EFEBB2D493E6");
        var plaintext =  HexToGoSlice("0C1D130BC23359EB39494FC31C17EF5694F071FEEA4F3760CB32D53AE58F3F7B8A401C91FE3FF08C29326D9CF97C8398C8F25CF3A85E10B57E271BE0B0DB37248FB95DB4FA78C7D836DF002E51974CF187B77B5F90491E0CD24AAEB0E29EDD6B1EE7CD571E4D371FFED04F49753A81233DCCA172AF30CC257538EA2086537BE559C450A6FCEFFE3464C10CE44F778F4328E4C80579B45ACFBECAFDA2B44A1E7F2883B28C35695106A29DDA2BB6C316FEFE8282D3787576C81683FD9CEDB744F70AF52F1F77E3BA5F424D1FA8341FD952416C98630B5EDBF1960EDC9936F52CB135D1792969B38B9868D844D0948DC3784D96B897B28AA3F7FFF35C157EEFC0C25528DF8938AFDEC59D3F9D4E11FF49B23297F6F9F4CED833B83E81640A41FDEE843DA98129504E034A8DE7AB091F10F0DF9B16C99C472AD4D4434E53FA0DD8F9FEF172D51706008F20DFD039F984237387A147E642DEE49E444962C69B5D0BBEA7D29B5E2749D1B483461BDF4FAC9702C7F25918B7280C0F99D76E033F71E7B873E787E4AD6B5E49D23C660770F992F6E6F9691D4B86A3E4C02A79AFBBC46C65BC34FA690FBE4822F65809B5C64A29F2CF6323450DCC489EA9C927B551E16074A83478BC9454042E5BE739728E5CA21DDDB7800FDCCAD05A53A755238C82D22BBA74BAFE9E76364679E0ABEC1147872F119DFBB91BA078B710DFD5DC5AA622C4230B63C23134B41EC34669B5599678FAFC58024AB8EF371E591880C7A939E3BC26C312ACF0CD632B65A26B5ECF20C180B2D0A6F2B09227B07839B068B5C9F71D1690837B52BE17ACC54A084B9ECDE25F37B6CC75A403C18E750424324EC69626DA3C7BF1644B4198363E89A032487EC5F9BFF004C50F2D44A0808BB4EEFB5D3D");
        var ciphertext = HexToGoSlice("77AEDD5903B7BDE48F91C8F989D0154361B8D84A8AD3D5F2437FBFC497B1C2B9FA3AAA45156D4FF6CFDC52FC785A6AB39829E7E36CDDD8B4B42D084514FA344B538C787EBEF937B64BAEC16FA61D61414E9AD1B5EC03BD3B3E4D6FBD34B11B559EAA10AB7F6515B239BD372B212C5079BC8AB99DDF6265FB28BBE8537C42CD7E29A285DF125643FA3440BCD486E86EFBF4CCC46F2A31E165E5CBA7A05143B04A5DBA4D80272E958203E6D73F3FDE72835269BD5465286E90F811E5803541AE2AB256283A28BB0DB378DACE10410C010EE1B6811243209087CB6B9BA01BD2749DF4300DD9291851115B5058C49C5301724763D78539756636F4684121C0AAC2D87FCE397C5B43D7F1B94821FF5BF39D22F00E6143B002DA27DC6277B36F581B3606A05009AFDAA2874D662EBAE9188BCD05A220F8CE230ABC8C074A735C25693072447520747E88B2D4D1FF7A012175C479F48A4D205D633E03CE9525FFD51F61BA3E9FE03F7CE5E8B542DF28B52483CC13761C956DAF7AC4A2461BCCB7B602E19C7A7E0A1B9D5727E250D20708039351C955303771C0408D54673E028CE8D4F568DEBA0ECB71950B3D50DEAFBA150C125287CEB6EE19F72544FC833EAC938EBC8A520CF45B7630D5D874EA2F2278E3CB5AAEE10291FF0E740D84964C7266465F7AC771BBFE2EA2A27F28D93D9DC0AF438A9F4338818F903A92ED48AF3C0E52859E7CEBE030C653F1A5C5D3075FF5066017AACE54EDAF367A3A23EEFC61018B357C31E94600D3343426F3A2AB1EEB314FAF9B234F4540837BE878FDCA3D672052E260A6E2FF3330C0575B437D3BE27C2643A68C8793731BDC68CA6EBFD1D2668CEFC597379E6624762BE5D84900D25FBB4857B48675E2A53E92A290DC1050CAC9");

        for (int i = 0; i < 3; i++) {
            var proof = INSTANCE.Prove(key, nonce, 1, plaintext,ciphertext);
            byte[] proofBuf = proof.r0.getByteArray(0, (int) proof.r1);
            System.out.println(HexFormat.of().formatHex(proofBuf));
            System.out.println(proof.r1);
            INSTANCE.Free(proof.r0); // !!!
        }
    }

    static LibGnarkChacha20.GoSlice.ByValue HexToGoSlice(String data){
        return new LibGnarkChacha20.GoSlice.ByValue(HexFormat.of().parseHex(data));
    }
}